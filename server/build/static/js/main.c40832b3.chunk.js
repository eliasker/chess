(this["webpackJsonpchess-client"]=this["webpackJsonpchess-client"]||[]).push([[0],{120:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n(9),s=n.n(c),i=n(11),o=n(144),a=Object(r.createContext)(),u=n(60),l=n.n(u),j=n(41),d=n.n(j),m="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",b={time:0,score:0,id:null,username:null,color:""},O={id:null,state:m,winner:null,host:b,player:b,connections:[]},h=n(2),p=function(e){var t=e.id,n=e.score;return Object(h.jsxs)("div",{className:"opposite-container",children:[null===t?Object(h.jsx)("p",{children:"No opponent connected"}):Object(h.jsxs)("p",{children:["Guest#",t.slice(0,4)]}),Object(h.jsxs)("p",{children:["Score: ",n]})]})},f=function(e){var t=e.game,n=e.user,r=e.handleReset,c="Game over: ".concat("draw"===t.winner?"draw":t.winner===n.username?"You won":"You lost");return Object(h.jsx)(h.Fragment,{children:null===t.winner?null:Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)("p",{children:c}),Object(h.jsx)("button",{onClick:function(){return r(!0)},children:"Rematch"})]})})},x=n(139),g=n(145),v=Object(x.a)((function(e){return{root:{position:"relative"},dropdown:{top:28,right:0,left:0,zIndex:1,border:"1px solid",padding:e.spacing(1),backgroundColor:e.palette.background.paper}}})),w=function(e){var t=e.description,n=e.buttonName,c=e.acceptFunction,s=v(),o=Object(r.useState)(!1),a=Object(i.a)(o,2),u=a[0],l=a[1],j=function(){return l(!1)};return Object(h.jsx)(g.a,{onClickAway:j,children:Object(h.jsxs)("div",{className:s.root,children:[Object(h.jsx)("button",{onClick:function(){return l(!u)},children:n}),u?Object(h.jsxs)("div",{className:s.dropdown,children:[t,Object(h.jsx)("button",{onClick:j,children:"Cancel"}),Object(h.jsx)("button",{onClick:function(){j(),c()},children:"Confirm"})]}):null]})})},C=new l.a,S=function(e){var t=e.selectedGame,n=e.emitState,c=e.emitLeave,s=e.emitEnd,o=Object(r.useContext)(a),u=o.user,l=o.setSelectedGame,j=o.emitRematch,b=o.setErrorMessage,x=Object(r.useState)(m),g=Object(i.a)(x,2),v=g[0],S=g[1];Object(r.useEffect)((function(){try{C.load(t.state),S(C.fen())}catch(e){b("Failed to load boardstate")}}),[t]);var k=function(e){n(t.id,e)},y=function(e){(u.userID===t.host.id?t.host.color.split("")[0]===C.turn():u.userID===t.player.id&&t.player.color.split("")[0]===C.turn())&&C.move(e)&&(S(C.fen()),k(C.fen()),C.game_over()&&(C.in_draw()?s(t.id,u.userID,"draw"):s(t.id,u.userID,"win")))},D=function(){return t.player.id===u.userID},I=function(){return t.host.id===u.userID};return Object(h.jsx)("div",{className:"center-container",children:Object(h.jsx)("div",{children:null===t.id?Object(h.jsx)("p",{children:"No game selected"}):Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)("p",{children:"Game#".concat(t.id.slice(0,4))}),I()||D()?Object(h.jsx)(w,{description:"Leave game?",buttonName:"Leave game",acceptFunction:function(){c(u.userID,t.id),l(O)}}):null,D()?Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(p,{id:t.host.id,score:t.host.score}),Object(h.jsx)(d.a,{width:400,position:v,orientation:t.player.color,onDrop:function(e){return y({from:e.sourceSquare,to:e.targetSquare,promotion:"q"})}}),Object(h.jsx)(p,{id:t.player.id,score:t.player.score})]}):Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(p,{id:t.player.id,score:t.player.score}),Object(h.jsx)(d.a,{width:400,position:v,orientation:t.host.color,onDrop:function(e){return y({from:e.sourceSquare,to:e.targetSquare,promotion:"q"})}}),Object(h.jsx)(p,{id:t.host.id,score:t.host.score})]}),I()||D()?Object(h.jsx)(w,{description:"Surrender?",buttonName:"Surrender",acceptFunction:function(){(C.fen()!==m||C.game_over())&&(I()||D())&&s(t.id,u.userID,"loss")}}):null,Object(h.jsx)(f,{game:t,user:u,handleReset:function(e){C.reset(),S(C.fen()),k(C.fen()),e&&j(t.id)}})]})})})},k=(n(86),n(42)),y=n.n(k),D=n(32),I=n(69),N=function(){var e=Object(r.useContext)(a),t=e.user,n=e.setSelectedGame,c=e.emitCreateGame,s=e.setErrorMessage,i=function(){var e=Object(I.a)(y.a.mark((function e(){var r,i,a,u,l,j;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Math.random()>.5?"white":"black",i=Object(D.a)(Object(D.a)({},b),{},{id:t.userID,username:t.username,color:r}),a=Object(D.a)(Object(D.a)({},O),{},{id:Object(o.a)(),host:i}),e.next=5,c(a);case 5:u=e.sent,l=u.success,j=u.message,l?n(a):s(j);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(h.jsx)("div",{className:"create-game",children:Object(h.jsx)("button",{onClick:function(){return i()},children:"Create game"})})},G=function(e){var t=e.selectedID,n=e.games,c=e.emitJoin,s=Object(r.useContext)(a),i=s.user,o=s.setSelectedGame;return Object(h.jsxs)("div",{className:"game-list",children:[Object(h.jsx)(N,{}),0===Object.keys(n).length?Object(h.jsx)("p",{children:"No ongoing games"}):Object(h.jsx)("ul",{children:Object.keys(n).map((function(e){return Object(h.jsxs)("li",{className:"".concat(e===t?"highlight clickable":"clickable"),onClick:function(){return function(e){n[e].host.id!==i.userID&&c(i,e,!1),o(n[e])}(e)},children:["Game#",e.slice(0,4),Object(h.jsx)(h.Fragment,{children:n[e].host.id!==i.userID&&null===n[e].player.id?Object(h.jsx)("button",{onClick:function(){return function(e){null===n[e].player.id&&c(i,e,!0),o(n[e])}(e)},children:"Join"}):null})]},e)}))})]})},E=n(70),F=n.n(E),P=function(e,t,n){var c=Object(r.useState)([]),s=Object(i.a)(c,2),o=s[0],a=s[1],u=Object(r.useState)([]),l=Object(i.a)(u,2),j=l[0],d=l[1],m=Object(r.useState)(O),b=Object(i.a)(m,2),h=b[0],p=b[1],f=Object(r.useRef)();Object(r.useEffect)((function(){return f.current=F()("http://localhost:3001/"),f.current.emit("join server",{userID:e,username:t}),f.current.on("update users",(function(e){a(e)})),f.current.on("update games",(function(e){d(e)})),f.current.on("game update",(function(e){p(e)})),f.current.on("connect_error",(function(e){n("Connection to server failed")})),function(){f.current.disconnect()}}),[e,t,n]);return{connectedUsers:o,currentGames:j,emitCreateGame:function(e){return new Promise((function(t){f.current.emit("create game",e,(function(e){t({success:e.successful,message:e.message})}))}))},emitState:function(e,t){f.current.emit("move",e,t)},gameUpdate:h,emitJoin:function(e,t,n){f.current.emit("join game",e,t,n)},emitRematch:function(e){f.current.emit("new game",e)},emitLeave:function(e,t){f.current.emit("leave game",e,t)},emitEnd:function(e,t,n){f.current.emit("game over",e,t,n)}}},R=n(143),q=n(142),M=function(e){var t=e.errorMessage,n=e.setErrorMessage;return Object(h.jsx)(h.Fragment,{children:Object(h.jsx)(R.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:""!==t,children:Object(h.jsx)(q.a,{onClose:function(){return n("")},severity:"error",children:t})})})},J=Object(o.a)(),L={userID:J,username:"Guest#".concat(J.slice(0,4))},U=function(){var e=Object(r.useState)(O),t=Object(i.a)(e,2),n=t[0],c=t[1],s=Object(r.useState)(""),o=Object(i.a)(s,2),u=o[0],l=o[1],j=P(L.userID,L.username,l),d=j.connectedUsers,m=j.currentGames,b=j.emitCreateGame,p=j.emitState,f=j.gameUpdate,x=j.emitJoin,g=j.emitRematch,v=j.emitLeave,w=j.emitEnd;return Object(r.useEffect)((function(){try{f.id===n.id&&c(f)}catch(e){}}),[f]),Object(h.jsx)(a.Provider,{value:{user:L,setSelectedGame:c,emitCreateGame:b,emitRematch:g,setErrorMessage:l},children:Object(h.jsxs)("div",{className:"grid-container",children:[Object(h.jsx)("div",{className:"icon"}),Object(h.jsxs)("div",{className:"user",children:[Object(h.jsxs)("p",{children:["logged in as ",L.username]}),Object(h.jsxs)("p",{children:["players online: ",Object.keys(d).length]})]}),Object(h.jsx)(G,{selectedID:n.id,games:m,emitJoin:x}),Object(h.jsx)(S,{selectedGame:n,emitState:p,emitLeave:v,emitEnd:w}),Object(h.jsx)(M,{errorMessage:u,setErrorMessage:l})]})})};s.a.render(Object(h.jsx)(U,{}),document.getElementById("root"))},86:function(e,t,n){}},[[120,1,2]]]);
//# sourceMappingURL=main.c40832b3.chunk.js.map