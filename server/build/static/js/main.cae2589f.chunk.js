(this["webpackJsonpchess-client"]=this["webpackJsonpchess-client"]||[]).push([[0],{119:function(e,t,n){"use strict";n.r(t);var c=n(0),r=n(9),s=n.n(r),i=n(11),a=n(142),o=Object(c.createContext)(),u=n(59),l=n.n(u),j=n(41),d=n.n(j),m="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",b={time:0,score:0,id:null,username:null,color:""},O={id:null,state:m,winner:null,host:b,player:b,connections:[]},h=n(2),f=function(e){var t=e.id,n=e.score;return Object(h.jsxs)("div",{className:"opposite-container",children:[null===t?Object(h.jsx)("p",{children:"No opponent connected"}):Object(h.jsxs)("p",{children:["Guest#",t.slice(0,4)]}),Object(h.jsxs)("p",{children:["Score: ",n]})]})},p=function(e){var t=e.game,n=e.user,c=e.handleReset,r="Game over: ".concat("draw"===t.winner?"draw":t.winner===n.username?"You won":"You lost");return Object(h.jsx)(h.Fragment,{children:null===t.winner?null:Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)("p",{children:r}),Object(h.jsx)("button",{onClick:function(){return c(!0)},children:"Rematch"})]})})},x=n(143),g=function(e){var t=e.disable,n=e.description,r=e.buttonName,s=e.acceptFunction,a=Object(c.useState)(!1),o=Object(i.a)(a,2),u=o[0],l=o[1],j=function(){return l(!1)};return Object(h.jsx)(x.a,{onClickAway:j,children:Object(h.jsx)("div",{children:u?Object(h.jsxs)("span",{children:[n,Object(h.jsx)("button",{onClick:j,style:{marginLeft:10},children:"Cancel"}),Object(h.jsx)("button",{onClick:function(){j(),s()},children:"Confirm"})]}):Object(h.jsx)("button",{disabled:t,onClick:function(){return l(!u)},children:r})})})},v=function(e){var t=e.status,n=t.isMyTurn?"Your turn":"w"===t.turn?"Turn: white":"Turn: black",c=t.in_check?", in check":null;return Object(h.jsx)(h.Fragment,{children:Object(h.jsxs)("p",{children:[n,c]})})},w=new l.a,k=function(e){var t=e.selectedGame,n=e.emitState,r=e.emitLeave,s=e.emitEnd,a=Object(c.useContext)(o),u=a.user,l=a.setSelectedGame,j=a.emitRematch,b=a.setErrorMessage,x=Object(c.useState)(m),k=Object(i.a)(x,2),y=k[0],S=k[1],C=Object(c.useState)({}),D=Object(i.a)(C,2),G=D[0],I=D[1],N=function(){return u.userID===t.host.id?t.host.color.split("")[0]===w.turn():u.userID===t.player.id&&t.player.color.split("")[0]===w.turn()};Object(c.useEffect)((function(){try{w.load(t.state),S(w.fen()),I({isMyTurn:N(),turn:w.turn(),over:w.game_over(),draw:w.in_draw(),in_check:w.in_check(),in_check_mate:w.in_checkmate()})}catch(e){b("Failed to load boardstate")}}),[t]);var E=function(e){n(t.id,e)},F=function(e){N()&&w.move(e)&&(S(w.fen()),E(w.fen()),w.game_over()&&(w.in_draw()?s(t.id,u.userID,"draw"):s(t.id,u.userID,"win")))},_=function(){return t.player.id===u.userID},M=function(){return t.host.id===u.userID};return Object(h.jsx)("div",{className:"center-container",children:Object(h.jsx)("div",{children:null===t.id?Object(h.jsx)("p",{children:"No game selected"}):Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)("p",{children:"Game#".concat(t.id.slice(0,4))}),M()||_()?Object(h.jsx)(g,{disable:!1,description:"Leave game?",buttonName:"Leave game",acceptFunction:function(){r(u.userID,t.id),l(O)}}):null,_()?Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(f,{id:t.host.id,score:t.host.score}),Object(h.jsx)(d.a,{width:400,position:y,orientation:t.player.color,onDrop:function(e){return F({from:e.sourceSquare,to:e.targetSquare,promotion:"q"})}}),Object(h.jsx)(f,{id:t.player.id,score:t.player.score})]}):Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(f,{id:t.player.id,score:t.player.score}),Object(h.jsx)(d.a,{width:400,position:y,orientation:t.host.color,onDrop:function(e){return F({from:e.sourceSquare,to:e.targetSquare,promotion:"q"})}}),Object(h.jsx)(f,{id:t.host.id,score:t.host.score})]}),M()||_()?Object(h.jsx)(g,{disable:y===m,description:"Surrender?",buttonName:"Surrender",acceptFunction:function(){(w.fen()!==m||w.game_over())&&(M()||_())&&null===t.winner&&s(t.id,u.userID,"loss")}}):null,Object(h.jsx)(v,{status:G}),Object(h.jsx)(p,{game:t,user:u,handleReset:function(e){w.reset(),S(w.fen()),E(w.fen()),e&&j(t.id)}})]})})})},y=(n(85),n(42)),S=n.n(y),C=n(31),D=n(60),G=function(){var e=Object(c.useContext)(o),t=e.user,n=e.setSelectedGame,r=e.emitCreateGame,s=e.setErrorMessage,i=function(){var e=Object(D.a)(S.a.mark((function e(){var c,i,o,u,l,j;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=Math.random()>.5?"white":"black",i=Object(C.a)(Object(C.a)({},b),{},{id:t.userID,username:t.username,color:c}),o=Object(C.a)(Object(C.a)({},O),{},{id:Object(a.a)(),host:i}),e.next=5,r(o);case 5:u=e.sent,l=u.success,j=u.message,l?n(o):s(j);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(h.jsx)("div",{className:"create-game",children:Object(h.jsx)("button",{onClick:function(){return i()},children:"Create game"})})},I=function(e){var t=e.selectedID,n=e.games,r=e.emitJoin,s=Object(c.useContext)(o),i=s.user,a=s.setSelectedGame;return Object(h.jsxs)("div",{className:"game-list",children:[Object(h.jsx)(G,{}),0===Object.keys(n).length?Object(h.jsx)("p",{children:"No ongoing games"}):Object(h.jsx)("ul",{children:Object.keys(n).map((function(e){return Object(h.jsxs)("li",{className:"".concat(e===t?"highlight clickable":"clickable"),onClick:function(){return function(e){n[e].host.id!==i.userID&&r(i,e,!1),a(n[e])}(e)},children:["Game#",e.slice(0,4),Object(h.jsx)(h.Fragment,{children:n[e].host.id!==i.userID&&null===n[e].player.id?Object(h.jsx)("button",{onClick:function(){return function(e){null===n[e].player.id&&r(i,e,!0),a(n[e])}(e)},children:"Join"}):null})]},e)}))})]})},N=n(61),E=n.n(N),F=function(e,t,n){var r=Object(c.useState)([]),s=Object(i.a)(r,2),a=s[0],o=s[1],u=Object(c.useState)([]),l=Object(i.a)(u,2),j=l[0],d=l[1],m=Object(c.useState)(O),b=Object(i.a)(m,2),h=b[0],f=b[1],p=Object(c.useRef)();Object(c.useEffect)((function(){return p.current=E()(),p.current.emit("join server",{userID:e,username:t}),p.current.on("update users",(function(e){o(e)})),p.current.on("update games",(function(e){d(e)})),p.current.on("game update",(function(e){f(e)})),p.current.on("connect_error",(function(e){n("Connection to server failed")})),function(){p.current.disconnect()}}),[e,t,n]);return{connectedUsers:a,currentGames:j,emitCreateGame:function(e){return new Promise((function(t){p.current.emit("create game",e,(function(e){t({success:e.successful,message:e.message})}))}))},emitState:function(e,t){p.current.emit("move",e,t)},gameUpdate:h,emitJoin:function(e,t,n){p.current.emit("join game",e,t,n)},emitRematch:function(e){p.current.emit("new game",e)},emitLeave:function(e,t){p.current.emit("leave game",e,t)},emitEnd:function(e,t,n){p.current.emit("game over",e,t,n)}}},_=n(141),M=n(140),P=function(e){var t=e.errorMessage,n=e.setErrorMessage;return Object(h.jsx)(h.Fragment,{children:Object(h.jsx)(_.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:""!==t,children:Object(h.jsx)(M.a,{onClose:function(){return n("")},severity:"error",children:t})})})},R=Object(a.a)(),q={userID:R,username:"Guest#".concat(R.slice(0,4))},J=function(){var e=Object(c.useState)(O),t=Object(i.a)(e,2),n=t[0],r=t[1],s=Object(c.useState)(""),a=Object(i.a)(s,2),u=a[0],l=a[1],j=F(q.userID,q.username,l),d=j.connectedUsers,m=j.currentGames,b=j.emitCreateGame,f=j.emitState,p=j.gameUpdate,x=j.emitJoin,g=j.emitRematch,v=j.emitLeave,w=j.emitEnd;return Object(c.useEffect)((function(){try{p.id===n.id&&r(p)}catch(e){}}),[p]),Object(h.jsx)(o.Provider,{value:{user:q,setSelectedGame:r,emitCreateGame:b,emitRematch:g,setErrorMessage:l},children:Object(h.jsxs)("div",{className:"grid-container",children:[Object(h.jsx)("div",{className:"icon"}),Object(h.jsxs)("div",{className:"user",children:[Object(h.jsxs)("p",{children:["logged in as ",q.username]}),Object(h.jsxs)("p",{children:["players online: ",Object.keys(d).length]})]}),Object(h.jsx)(I,{selectedID:n.id,games:m,emitJoin:x}),Object(h.jsx)(k,{selectedGame:n,emitState:f,emitLeave:v,emitEnd:w}),Object(h.jsx)(P,{errorMessage:u,setErrorMessage:l})]})})};s.a.render(Object(h.jsx)(J,{}),document.getElementById("root"))},85:function(e,t,n){}},[[119,1,2]]]);
//# sourceMappingURL=main.cae2589f.chunk.js.map